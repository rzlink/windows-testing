# Values for deploying Hyper-V mutating webhook
# Usage: helm install hyperv-webhook ./helm -f values-hyperv.yaml
#
# Override registry and version via environment variables:
#   helm install hyperv-webhook ./helm -f values-hyperv.yaml \
#     --set deployment.image.registry=$REGISTRY \
#     --set deployment.image.tag=$VERSION

webhookType: hyperv

deployment:
  image:
    # Uses default registry from values.yaml: sigwindowstools
    # Override with: --set deployment.image.registry=myregistry.io/myorg
    tag: ""  # Uses chart appVersion by default, override with --set deployment.image.tag=$VERSION

  # controller-runtime manages TLS and flags internally, no args needed
  args: []

  # controller-runtime default cert directory
  certMountPath: /tmp/k8s-webhook-server/serving-certs

  # controller-runtime serves health checks on a separate HTTP port
  livenessProbe:
    httpGet:
      path: /healthz
      port: 8081
      scheme: HTTP
    initialDelaySeconds: 15
    periodSeconds: 20
    timeoutSeconds: 1
    successThreshold: 1
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /readyz
      port: 8081
      scheme: HTTP
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 1
    successThreshold: 1
    failureThreshold: 3

webhookConfiguration:
  objectSelector:
    matchLabels:
      hyperv-isolation: "true"

# RuntimeClass configuration for Hyper-V
runtimeClass:
  enabled: true
  name: runhcs-wcow-hypervisor
  handler: runhcs-wcow-hypervisor

# Hyper-V specific configuration
hypervConfig:
  # Default Hyper-V isolation settings
  runtimeClassName: runhcs-wcow-hypervisor
  
  # CPU and memory limits for Hyper-V isolated containers
  defaultResources:
    cpuLimit: "1000m"
    memoryLimit: "2Gi"
  
  # Enable automatic resource adjustment
  autoAdjustResources: true
